/*!
 * csrdelft.dataTables.js
 * 
 * @author P.W.G. Brussee <brussee@live.nl>
 * 
 * Group by & multi-select capabilities.
 */
var bOrderDraw=false;$(document).ready(function(){fnInitDataTables()});function fnInitDataTables(){$.extend($.fn.dataTable.defaults,{dom:"frtpli",lengthMenu:[[10,15,25,50,100,-1],[10,15,25,50,100,"Alles"]],});$.fn.dataTable.ext.search.push(fnGroupExpandCollapseDraw)}function fnMultiSelect(b){if(b.hasClass("group")){if(b.nextUntil(".group").not(".selected").length!==0){if(!bShiftPressed){b.siblings(".selected").removeClass("selected")}b.nextUntil(".group").addClass("selected")}else{b.nextUntil(".group").removeClass("selected")}}else{if(!b.children(":first").hasClass("dataTables_empty")){b.toggleClass("selected");if(bShiftPressed){var a=b.hasClass("selected");if(b.prevAll(".selected").not(".group").length!==0){b.prevUntil(".selected").not(".group").each(function(){$(this).toggleClass("selected",a)})}else{if(b.nextAll(".selected").not(".group").length!==0){b.nextUntil(".selected").not(".group").each(function(){$(this).toggleClass("selected",a)})}}}}}}function fnGetGroupByColumn(a){var b=parseInt(a.attr("groupByColumn"));if(isNaN(b)){return false}return b}function fnGroupByColumn(g,b){if(bOrderDraw||!bCtrlPressed){return}var c=$(b.nTable);var f=c.DataTable();var d=fnGetGroupByColumn(c);var a=f.order();f.column(d).visible(true);d=a[0][0];f.column(d).visible(false);c.attr("groupByColumn",d);c.data("collapsedGroups",[]);b.aaSortingFixed=a.slice();bOrderDraw=true;f.draw()}function fnGroupByColumnDraw(h,f){if(bOrderDraw){bOrderDraw=false;return}var k=$(f.nTable);var a=fnGetGroupByColumn(k);if(a===false){return}var i=k.data("collapsedGroups").slice();var d=f.aoColumns.length-1;var b;if(f.aiDisplay.length>0){var c=k.DataTable();var l=$(c.rows({page:"current"}).nodes());var j=null;c.column(a,{page:"current"}).data().each(function(m,e){if(j!==m){while(i.length>0&&i[0].localeCompare(m)<0){b=$('<tr class="group"><td class="details-control"></td><td colspan="'+d+'">'+i[0]+"</td></tr>").data("groupData",i[0]);l.eq(e).before(b);i.shift()}b=$('<tr class="group expanded"><td class="details-control"></td><td colspan="'+d+'">'+m+"</td></tr>").data("groupData",m);l.eq(e).before(b);j=m}})}var g=k.children("tbody:first");i.forEach(function(e){b=$('<tr class="group"><td class="details-control"></td><td colspan="'+d+'">'+e+"</td></tr>").data("groupData",e);g.append(b)})}function fnGroupExpandCollapse(c,b,f){var a=b.parent().parent();var e=a.data("collapsedGroups");b.toggleClass("expanded");var d=b.data("groupData");if(b.hasClass("expanded")){e=$.grep(e,function(g){return g!==d})}else{e.push(d)}a.data("collapsedGroups",e.sort());bCtrlPressed=false;c.draw()}function fnGroupExpandCollapseDraw(b,e,a){var c=$(b.nTable);var d=fnGetGroupByColumn(c);if(d===false){return true}var f=e[d];var g=c.data("collapsedGroups");if($.inArray(f,g)>-1){return false}return true}function fnChildRow(c,e){var b=e.closest("tr");if(b.hasClass("group")){fnGroupExpandCollapse(c,b,e);return}var d=c.row(b);if(d.child.isShown()){if(b.hasClass("loading")){}else{b.removeClass("expanded");var a=b.next().children(":first").children(":first");a.slideUp(400,function(){d.child.hide()})}}else{d.child('<div class="innerDetails" style="display: none;"></div>').show();b.addClass("expanded loading");var a=b.next().addClass("childrow").children(":first").children(":first");$.ajax({url:e.attr("detailSource")}).done(function(f){if(d.child.isShown()){b.removeClass("loading");a.html(f).slideDown()}})}};