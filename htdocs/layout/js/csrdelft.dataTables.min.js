/*!
 * csrdelft.dataTables.js
 * 
 * @author P.W.G. Brussee <brussee@live.nl>
 * 
 * Group by & multi-select capabilities.
 */
var bOrderDraw=false;$(document).ready(function(){fnInitDataTables()});function fnInitDataTables(){$.extend($.fn.dataTable.defaults,{dom:"frtpli",lengthMenu:[[10,15,25,50,100,-1],[10,15,25,50,100,"Alles"]],});$.fn.dataTable.ext.search.push(fnGroupExpandCollapseDraw)}function fnMultiSelect(b){if(b.hasClass("group")){if(b.nextUntil(".group").not(".selected").length!==0){if(!bShiftPressed){b.siblings(".selected").removeClass("selected")}b.nextUntil(".group").addClass("selected")}else{b.nextUntil(".group").removeClass("selected")}}else{if(!b.children(":first").hasClass("dataTables_empty")){b.toggleClass("selected");if(bShiftPressed){var a=b.hasClass("selected");if(b.prevAll(".selected").not(".group").length!==0){b.prevUntil(".selected").not(".group").each(function(){$(this).toggleClass("selected",a)})}else{if(b.nextAll(".selected").not(".group").length!==0){b.nextUntil(".selected").not(".group").each(function(){$(this).toggleClass("selected",a)})}}}}}}function fnGetGroupByColumn(a){var b=parseInt(a.attr("groupByColumn"));if(isNaN(b)){return false}return b}function fnGroupByColumn(g,b){if(bOrderDraw||!bCtrlPressed){return}var c=$(b.nTable);var f=c.DataTable();var d=fnGetGroupByColumn(c);var a=f.order();f.column(d).visible(true);d=a[0][0];f.column(d).visible(false);c.attr("groupByColumn",d);c.removeClass("collapseAll");c.data("expandedGroups",[]);c.data("collapsedGroups",[]);b.aaSortingFixed=a.slice();bOrderDraw=true;f.draw()}function fnGroupByColumnDraw(h,f){if(bOrderDraw){bOrderDraw=false;return}var k=$(f.nTable);var a=fnGetGroupByColumn(k);if(a===false){return}var c=k.DataTable();var l=c.rows({page:"current"}).nodes();if(l.length<1){console.log(l.length);return}var g=$(l).first();var b;var d=f.aoColumns.length-1;var i=k.data("collapsedGroups");i.forEach(function(e){b=$('<tr class="group"><td class="details-control"></td><td colspan="'+d+'">'+e+"</td></tr>").data("groupData",e);g.before(b)});var j=null;c.column(a,{page:"current"}).data().each(function(m,e){if(j!==m){b=$('<tr class="group expanded"><td class="details-control"></td><td colspan="'+d+'">'+m+"</td></tr>").data("groupData",m);$(l).eq(e).before(b);j=m}})}function fnGroupExpandCollapse(d,c,g){var b=c.parent().parent();var a=b.data("expandedGroups");var f=b.data("collapsedGroups");c.toggleClass("expanded");var e=c.data("groupData");if(b.hasClass("collapseAll")){if(c.hasClass("expanded")){a.push(e)}else{a=$.grep(a,function(h){return h!==e})}}else{if(c.hasClass("expanded")){f=$.grep(f,function(h){return h!==e})}else{f.push(e)}}b.data("expandedGroups",a);b.data("collapsedGroups",f);bCtrlPressed=false;d.draw()}function fnGroupExpandCollapseDraw(c,f,a){var d=$(c.nTable);var e=fnGetGroupByColumn(d);if(e===false){return true}var g=f[e];if(d.hasClass("collapseAll")){var b=d.data("expandedGroups");if($.inArray(g,b)>-1){return true}return false}else{var h=d.data("collapsedGroups");if($.inArray(g,h)>-1){return false}return true}}function fnChildRow(c,e){var b=e.closest("tr");if(b.hasClass("group")){fnGroupExpandCollapse(c,b,e);return}var d=c.row(b);if(d.child.isShown()){if(b.hasClass("loading")){}else{b.removeClass("expanded");var a=b.next().children(":first").children(":first");a.slideUp(400,function(){d.child.hide()})}}else{d.child('<div class="innerDetails" style="display: none;"></div>').show();b.addClass("expanded loading");var a=b.next().addClass("childrow").children(":first").children(":first");$.ajax({url:e.attr("detailSource")}).done(function(f){if(d.child.isShown()){b.removeClass("loading");a.html(f).slideDown()}})}};